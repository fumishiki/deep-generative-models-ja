#!/usr/bin/env python3
"""
Generate Lecture 08 Part1/Part2 markdown in a GitHub-first style.

Constraints enforced by construction:
- Part1: exactly 1 python block (Quickstart) and no other implementation code blocks.
- Part2: 2 python blocks, each preceded by a matching ```math block (Mathâ†”Code 1:1).
- No Zenn-only syntax (:::, @[card], $$).
- time_estimate fixed to "90 minutes" (frontmatter is emitted as-is).
"""

from __future__ import annotations

from dataclasses import dataclass
from pathlib import Path


ROOT = Path(__file__).resolve().parents[1]
ARTICLES = ROOT / "articles"


def write_lines(path: Path, lines: list[str]) -> None:
    path.parent.mkdir(parents=True, exist_ok=True)
    text = "\n".join(lines).rstrip() + "\n"
    path.write_text(text, encoding="utf-8")


def mermaid_graphical_model() -> list[str]:
    return [
        "```mermaid",
        "flowchart LR",
        "  subgraph plate[plate i = 1..N]",
        "    z((z_i)) --> x([x_i])",
        "  end",
        "  theta[[Î¸]] -.-> x",
        "  theta -.-> z",
        "```",
    ]


def mermaid_em_flow() -> list[str]:
    return [
        "```mermaid",
        "flowchart TD",
        "  A[init Î¸^(0)] --> B[E-step: q(z)=p(z|x,Î¸^(t))]",
        "  B --> C[M-step: Î¸^(t+1)=argmax_Î¸ E_q log p(x,z|Î¸)]",
        "  C --> D{Î”log p(x|Î¸) small?}",
        "  D -- no --> B",
        "  D -- yes --> E[done]",
        "```",
    ]


def mermaid_elbo_decomp() -> list[str]:
    return [
        "```mermaid",
        "flowchart LR",
        "  L[log p_Î¸(x)] -->|=| E[ELBO(q,Î¸)]",
        "  L -->|+| K[KL(q(z)||p_Î¸(z|x))]",
        "  K -->|â‰¥ 0| T[lower bound gap]",
        "```",
    ]


def mermaid_gmm_components() -> list[str]:
    return [
        "```mermaid",
        "flowchart LR",
        "  X[(x)] --> S{choose k ~ Categorical(Ï€)}",
        "  S --> K1[component 1: N(Î¼1,Î£1)]",
        "  S --> K2[component 2: N(Î¼2,Î£2)]",
        "  S --> K3[component K: N(Î¼K,Î£K)]",
        "```",
    ]


def mermaid_lineage() -> list[str]:
    return [
        "```mermaid",
        "flowchart TD",
        "  EM[EM] --> HMM[Baum-Welch (HMM)]",
        "  EM --> FA[Factor Analysis]",
        "  FA --> PPCA[Probabilistic PCA]",
        "  EM --> VEM[Variational EM]",
        "  VEM --> VAE[VAE / amortized inference]",
        "  EM --> EP[Expectation Propagation]",
        "  EM --> MoE[Mixture of Experts]",
        "```",
    ]


def mermaid_log_int_pain() -> list[str]:
    return [
        "```mermaid",
        "flowchart LR",
        "  A[want: max_Î¸ log p_Î¸(x)] --> B[but: p_Î¸(x)=âˆ« p_Î¸(x,z) dz]",
        "  B --> C[log outside integral: log âˆ« ... dz]",
        "  C --> D[no closed form / hard gradients]",
        "  D --> E[introduce q(z) and Jensen]",
        "```",
    ]


def mermaid_numeric_stability() -> list[str]:
    return [
        "```mermaid",
        "flowchart TD",
        "  A[raw density Ï€_k N(x|Î¼_k,Î£_k)] --> B[underflow to 0]",
        "  B --> C[log space: log Ï€_k + log N]",
        "  C --> D[normalize with log-sum-exp]",
        "  D --> E[exp back to Î³]",
        "  E --> F[assert row-sum == 1]",
        "```",
    ]


def mermaid_model_selection() -> list[str]:
    return [
        "```mermaid",
        "flowchart LR",
        "  D[data X] --> F[fit EM for each K]",
        "  F --> L[loglik(K)]",
        "  L --> A[AIC(K)]",
        "  L --> B[BIC(K)]",
        "  A --> S[select K (tradeoff)]",
        "  B --> S",
        "```",
    ]


def mermaid_singularity() -> list[str]:
    return [
        "```mermaid",
        "flowchart TD",
        "  A[component collapses] --> B[Î£_k shrinks]",
        "  B --> C[det(Î£_k) -> 0]",
        "  C --> D[log N(x|Î¼,Î£) -> +âˆ at a point]",
        "  D --> E[loglik spikes, Cholesky fails]",
        "  E --> F[fix: epsI / reinit / priors]",
        "```",
    ]


def frontmatter_part1() -> list[str]:
    return [
        "---",
        'title: "ç¬¬8å›: æ½œåœ¨å¤‰æ•°ãƒ¢ãƒ‡ãƒ« & EMç®—æ³• (Part1: ç†è«–ç·¨)"',
        'emoji: "ğŸ§©"',
        'type: "tech"',
        'topics: ["æ©Ÿæ¢°å­¦ç¿’", "æ•°å­¦", "çµ±è¨ˆå­¦", "Python"]',
        "published: false",
        'slug: "ml-lecture-08-part1"',
        'difficulty: "intermediate"',
        'time_estimate: "90 minutes"',
        'languages: ["Python"]',
        'keywords: ["æ½œåœ¨å¤‰æ•°", "EM", "Jensenä¸ç­‰å¼", "ELBO", "GMM", "è²¬ä»»åº¦"]',
        "---",
        "",
    ]


def frontmatter_part2() -> list[str]:
    return [
        "---",
        'title: "ç¬¬8å›: æ½œåœ¨å¤‰æ•°ãƒ¢ãƒ‡ãƒ« & EMç®—æ³• (Part2: å®Ÿè£…ç·¨)"',
        'emoji: "ğŸ§©"',
        'type: "tech"',
        'topics: ["æ©Ÿæ¢°å­¦ç¿’", "æ•°å­¦", "çµ±è¨ˆå­¦", "Python"]',
        "published: false",
        'slug: "ml-lecture-08-part2"',
        'difficulty: "intermediate"',
        'time_estimate: "90 minutes"',
        'languages: ["Python"]',
        'keywords: ["GMM", "EM", "log-sum-exp", "BIC", "AIC", "åˆæœŸåŒ–"]',
        "---",
        "",
    ]


def author_links_and_license() -> list[str]:
    return [
        "## è‘—è€…ãƒªãƒ³ã‚¯",
        "- Blog: https://fumishiki.dev",
        "- X: https://x.com/fumishiki",
        "- LinkedIn: https://www.linkedin.com/in/fumitakamurakami",
        "- GitHub: https://github.com/fumishiki",
        "- Hugging Face: https://huggingface.co/fumishiki",
        "",
        "## ãƒ©ã‚¤ã‚»ãƒ³ã‚¹",
        "- CC BY-NC-SA 4.0",
    ]


def build_part1() -> list[str]:
    L: list[str] = []
    L += frontmatter_part1()

    L += [
        "> **ã“ã®è¬›ç¾©ã«ã¤ã„ã¦**",
        "> æœ¬è¬›ç¾©ã¯ã€Œæ•°å­¦åŸºç¤ç·¨ï¼ˆCourse Iï¼‰ã€ç¬¬8å› Part1ï¼ˆç†è«–ç·¨ï¼‰ã€‚",
        "> ç¬¬7å›ã§å‡ºãŸå‘¨è¾ºåŒ– `\\(p(x)=\\int p(x,z)dz\\)` ã‚’ã€Jensenä¸ç­‰å¼ã‹ã‚‰å‡ºç™ºã—ã¦ ELBO ã«è½ã¨ã—ã€æœ€å¾Œã« EM ã® E/M-step ã«åˆ†è§£ã™ã‚‹ã€‚",
        ">",
        "> **å¾Œç·¨ã¯ã“ã¡ã‚‰**: [ç¬¬8å› Part2ï¼ˆå®Ÿè£…ç·¨ï¼‰](/articles/ml-lecture-08-part2)",
        "",
        "## Learning Objectives",
        "",
        "- [ ] æ½œåœ¨å¤‰æ•°ãƒ¢ãƒ‡ãƒ« `\\(p_\\theta(x)=\\int p_\\theta(x\\mid z)p(z)dz\\)` ã®é›£ã—ã•ã‚’æ•°å¼ã§èª¬æ˜ã§ãã‚‹",
        "- [ ] Jensen ä¸ç­‰å¼ã‹ã‚‰ ELBO ã‚’å°å‡ºã§ãã‚‹",
        "- [ ] EM ã®å˜èª¿å¢—åŠ ï¼ˆmonotonicityï¼‰ã®éª¨æ ¼ã‚’ç¤ºã›ã‚‹",
        "- [ ] GMM ã®è²¬ä»»åº¦ `\\(\\gamma_{ik}\\)` ã¨æ›´æ–°å¼ã‚’ shape ã¤ãã§èª¬æ˜ã§ãã‚‹",
        "- [ ] Generalized EM / ECM / label switching / singularity ã‚’è¨€èªåŒ–ã§ãã‚‹",
        "",
        "---",
        "",
        "## ğŸš€ Z1. ã‚¯ã‚¤ãƒƒã‚¯ã‚¹ã‚¿ãƒ¼ãƒˆï¼ˆ30ç§’ï¼‰",
        "",
        "EM ã¯ã€Œç›´æ¥æœ€å¤§åŒ–ã—ã«ãã„å‘¨è¾ºå°¤åº¦ `\\(\\log p_\\theta(x)\\)`ã€ã‚’ã€ä¸‹ç•Œï¼ˆELBOï¼‰ã‚’ä»‹ã—ã¦åå¾©ã§æŠ¼ã—ä¸Šã’ã‚‹ã€‚",
        "",
        "```math",
        "\\log p_\\theta(x) = \\mathrm{ELBO}(q,\\theta) + D_{\\mathrm{KL}}\\bigl(q(z)\\|p_\\theta(z\\mid x)\\bigr)",
        "```",
        "",
        "```python",
        "import numpy as np",
        "",
        "# 1D 2-component GMM EM (minimal quickstart)",
        "np.random.seed(0)",
        "N = 400",
        "x = np.concatenate([",
        "    np.random.normal(-2.0, 0.7, N // 2),",
        "    np.random.normal(2.0, 0.7, N // 2),",
        "])",
        "",
        "K = 2",
        "pi = np.array([0.5, 0.5])",
        "mu = np.array([-1.0, 1.0])",
        "var = np.array([1.0, 1.0])",
        "",
        "",
        "def normal_pdf(x, mu, var):",
        "    return (1.0 / np.sqrt(2 * np.pi * var)) * np.exp(-0.5 * (x - mu) ** 2 / var)",
        "",
        "",
        "def loglik(x, pi, mu, var, eps=1e-12):",
        "    p = sum(pi[k] * normal_pdf(x, mu[k], var[k]) for k in range(K))",
        "    return float(np.sum(np.log(p + eps)))",
        "",
        "",
        "for t in range(6):",
        "    # E-step: responsibilities",
        "    r = np.stack([pi[k] * normal_pdf(x, mu[k], var[k]) for k in range(K)], axis=1)",
        "    r = r / r.sum(axis=1, keepdims=True)",
        "",
        "    # M-step",
        "    Nk = r.sum(axis=0)",
        "    pi = Nk / N",
        "    mu = (r * x[:, None]).sum(axis=0) / Nk",
        "    var = (r * (x[:, None] - mu[None, :]) ** 2).sum(axis=0) / Nk",
        "",
        "    print(\"t=\", t, \"loglik=\", loglik(x, pi, mu, var))",
        "```",
        "",
        "> **Note:** ã“ã“ã§ã¯é›°å›²æ°—ã ã‘ã€‚å˜èª¿å¢—åŠ ãŒãªãœä¿è¨¼ã•ã‚Œã‚‹ã‹ã¯ã€ã“ã®å¾Œã™ã¹ã¦ Jensen ã‹ã‚‰å‡ºã™ã€‚",
        "",
        "---",
        "",
        "## ğŸ“– Z2. ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«ï¼ˆ10åˆ†ï¼‰",
        "",
        "ã“ã®å›ã®5ãƒˆãƒ”ãƒƒã‚¯ã¯ã€ã™ã¹ã¦åŒã˜ã‚´ãƒ¼ãƒ«ã«åæŸã™ã‚‹ã€‚",
        "",
        "| ãƒˆãƒ”ãƒƒã‚¯ | ä¸€è¨€ã§è¨€ãˆã° | ã©ã“ã§è©°ã¾ã‚‹ï¼Ÿ |",
        "|:--|:--|:--|",
        "| 1. æ½œåœ¨å¤‰æ•°ãƒ¢ãƒ‡ãƒ«ã®å®šå¼åŒ– | `\\(\\int\\)` ã‚’æŠ±ãˆãŸç¢ºç‡ãƒ¢ãƒ‡ãƒ« | å‘¨è¾ºåŒ–ã§ `\\(\\log\\)` ã®ä¸­ã«ç©åˆ†ãŒå…¥ã‚‹ |",
        "| 2. Jensenâ†’ELBO | `\\(\\log\\int\\)` ã‚’ä¸‹ç•Œã«ã™ã‚‹ | ã©ã“ã« `\\(q(z)\\)` ã‚’æŒ¿ã™ã®ã‹ |",
        "| 3. GMM-EMå°å‡º | å…·ä½“ä¾‹ã§å¼ãŒæ‰‹ã«å–ã‚Œã‚‹ | shape ã‚’è½ã¨ã—ã¦ç ´ç¶» |",
        "| 4. æ‹¡å¼µã¨å¹¾ä½• | EM ã‚’é“å…·ã¨ã—ã¦ä¸€èˆ¬åŒ– | ä½•ã‚’å›ºå®šã—ã¦ä½•ã‚’æœ€é©åŒ–ï¼Ÿ |",
        "| 5. Boss Battle | Qé–¢æ•°ã‚’å¤šå¤‰é‡ã§å±•é–‹ | è¡Œåˆ—å¼ã¨äºŒæ¬¡å½¢å¼ã¨è¶³ã—ç®—ã®é †åº |",
        "",
        "ã¾ãšã€æ½œåœ¨å¤‰æ•°ãƒ¢ãƒ‡ãƒ«ã®ç—›ã¿ã‚’æ­£é¢ã‹ã‚‰è¦‹ã‚‹ã€‚",
        "",
        "---",
        "",
        "## ğŸŒ Z3. ä¸–ç•Œè¦³ï¼ˆ20åˆ†ï¼‰",
        "",
        "### 3.1 è¦³æ¸¬ã ã‘ã§å®Œçµã—ãªã„ãƒ¢ãƒ‡ãƒ«",
        "",
        "æ½œåœ¨å¤‰æ•°ãƒ¢ãƒ‡ãƒ«ã®åŸºæœ¬å½¢ã¯ã“ã‚Œã€‚",
        "",
        "```math",
        "p_\\theta(x) = \\int p_\\theta(x\\mid z)\\,p(z)\\,dz",
        "```",
        "",
        "è¦³æ¸¬ `\\(x\\)` ã ã‘ã‚’è¦‹ã‚‹ã¨è¤‡é›‘ã ãŒã€æ½œåœ¨ `\\(z\\)` ã‚’å…¥ã‚Œã‚‹ã¨æ¡ä»¶ä»˜ãã§å˜ç´”ã«ãªã‚‹ã€‚",
        "",
        "- æ··åˆåˆ†å¸ƒ: `\\(z\\)` ãŒã€Œã©ã®æˆåˆ†ã‹ã‚‰æ¥ãŸã‹ã€",
        "- æ¬ æå€¤: `\\(z\\)` ãŒã€Œè¦³æ¸¬ã•ã‚Œã¦ã„ãªã„éƒ¨åˆ†ã€",
        "- ä½æ¬¡å…ƒè¡¨ç¾: `\\(z\\)` ãŒã€Œèª¬æ˜å¤‰æ•°ï¼ˆæ½œåœ¨ç©ºé–“ï¼‰ã€",
        "",
        "ã¨ã“ã‚ãŒ MLE ã‚’ã‚„ã‚ã†ã¨ã™ã‚‹ã¨ã€ã™ãå£ã«å½“ãŸã‚‹ã€‚",
        "",
        "```math",
        "\\theta^\\* = \\arg\\max_\\theta \\sum_{i=1}^N \\log p_\\theta(x_i)",
        "\\quad",
        "p_\\theta(x_i)=\\int p_\\theta(x_i,z_i)\\,dz_i",
        "```",
        "",
        "ã“ã“ã§ `\\(\\log\\)` ã¨ `\\(\\int\\)` ã®é †åºãŒè‡´å‘½çš„ã«æ‚ªã„ã€‚",
        "",
        "*mermaid: `\\(\\log\\int\\)` ã®ç—›ã¿*",
        "",
        "```mermaid",
        "flowchart LR",
        "  A[want: max_Î¸ log p_Î¸(x)] --> B[but: p_Î¸(x)=âˆ« p_Î¸(x,z) dz]",
        "  B --> C[log outside integral: log âˆ« ... dz]",
        "  C --> D[no closed form / hard gradients]",
        "  D --> E[introduce q(z) and Jensen]",
        "```",
        "",
        "### 3.2 ã‚°ãƒ©ãƒ•ã‚£ã‚«ãƒ«ãƒ¢ãƒ‡ãƒ«ã¨ã—ã¦çœºã‚ã‚‹",
        "",
        "æ½œåœ¨ `\\(z\\)` ã¯ã€æ€è€ƒã®ãŸã‚ã®å¯è¦–åŒ–ã§ã‚‚ã‚ã‚‹ã€‚",
        "",
        "*mermaid: æ½œåœ¨å¤‰æ•°ãƒ¢ãƒ‡ãƒ«ï¼ˆãƒ—ãƒ¬ãƒ¼ãƒˆï¼‰*",
        "",
    ]
    L += mermaid_graphical_model()
    L += [
        "",
        "ã“ã®å›³ã‚’è¦‹ã¦ã€æ¬¡ã®2ç‚¹ãŒç›´æ„Ÿã¨ã—ã¦æ´ã‚ã‚Œã°å‹ã¡ã€‚",
        "",
        "- ç”Ÿæˆæ–¹å‘: `\\(z_i\\to x_i\\)`ï¼ˆæ½œåœ¨ãŒè¦³æ¸¬ã‚’ç”Ÿã‚€ï¼‰",
        "- å­¦ç¿’æ–¹å‘: `\\(x_i\\)` ã‹ã‚‰ `\\(z_i\\)` ã‚’æ¨å®šã—ãŸããªã‚‹ï¼ˆäº‹å¾Œæ¨è«–ï¼‰",
        "",
        "### 3.3 æ½œåœ¨å¤‰æ•°ã‚’3ã¤ã®æ¯”å–©ã§æ‰ãˆã‚‹",
        "",
        "æ½œåœ¨å¤‰æ•°ã¯ã€åŒã˜è¨˜å·ã§ã‚‚æ„å‘³ãŒé•ã†ã€‚",
        "",
        "1. ãƒ©ãƒ™ãƒ«ï¼ˆé›¢æ•£ï¼‰: `\\(z_i\\in\\{1,\\dots,K\\}\\)`",
        "2. æ¬ æï¼ˆéƒ¨åˆ†è¦³æ¸¬ï¼‰: `\\(z_i\\)` ãŒè¦³æ¸¬ã§ããªã„æˆåˆ†",
        "3. åº§æ¨™ï¼ˆé€£ç¶šï¼‰: `\\(z_i\\in\\mathbb{R}^m\\)` ãŒä½æ¬¡å…ƒè¡¨ç¾",
        "",
        "åŒã˜ `\\(\\int\\)` ã§ã‚‚ã€é›¢æ•£ãªã‚‰å’Œã€é€£ç¶šãªã‚‰ç©åˆ†ã€‚ã“ã“ã¯æœ€åˆã«å›ºå®šã—ã¦ãŠãã€‚",
        "",
        "```math",
        "\\int p(x,z)dz",
        "\\quad\\text{ã¯}\\quad",
        "\\sum_{z} p(x,z) \\ \\text{ï¼ˆé›¢æ•£ï¼‰},",
        "\\qquad",
        "\\int_{\\mathbb{R}^m} p(x,z)\\,dz \\ \\text{ï¼ˆé€£ç¶šï¼‰}",
        "```",
        "",
        "æ¬¡ã«ã€ä¸‹ç•Œã¸ã®ä¸€æœ¬é“ã¸å…¥ã‚‹ã€‚",
        "",
        "---",
        "",
        "## âš”ï¸ Z4. Boss Battleï¼ˆ60åˆ†ï¼‰",
        "",
        "### 4.1 ã¾ãšã¯ç›®çš„é–¢æ•°ã‚’æ­£ç¢ºã«æ›¸ã",
        "",
        "ãƒ‡ãƒ¼ã‚¿ `\\(\\mathcal{D}=\\{x_i\\}_{i=1}^N\\)` ã«å¯¾ã—ã€å‘¨è¾ºå°¤åº¦ï¼ˆä¸å®Œå…¨ãƒ‡ãƒ¼ã‚¿å°¤åº¦ï¼‰ã‚’æœ€å¤§åŒ–ã—ãŸã„ã€‚",
        "",
        "```math",
        "\\mathcal{L}(\\theta)",
        "= \\sum_{i=1}^N \\log p_\\theta(x_i)",
        "= \\sum_{i=1}^N \\log \\int p_\\theta(x_i,z_i)\\,dz_i",
        "```",
        "",
        "ã“ã“ã§è©°ã¾ã‚‹ç†ç”±ã¯ã€å˜ã«ç©åˆ†ãŒé›£ã—ã„ã‹ã‚‰ã§ã¯ãªã„ã€‚",
        "",
        "- `\\(\\log\\int\\)` ã®å½¢ã¯ã€å¾®åˆ†ã—ã¦ã‚‚é–‰ã˜ãªã„",
        "- `\\(z\\)` ãŒé«˜æ¬¡å…ƒã ã¨ã€ç©åˆ†ã¯æŒ‡æ•°çš„ã«çˆ†ç™ºã™ã‚‹",
        "",
        "ã ã‹ã‚‰ã€ç›´æ¥ `\\(\\mathcal{L}(\\theta)\\)` ã‚’æœ€å¤§åŒ–ã—ãªã„ã€‚",
        "",
        "### 4.2 Jensenä¸ç­‰å¼: ã€Œãƒ­ã‚°ã®ä¸­èº«ã€ã‚’å¹³å‡ã«ã™ã‚‹",
        "",
        "éµã¯ã€`\\(\\log\\)` ã®å‰ã«ã€ŒæœŸå¾…å€¤ã€ã‚’ç½®ãã“ã¨ã€‚",
        "",
        "```math",
        "\\log \\mathbb{E}[Y] \\ge \\mathbb{E}[\\log Y]",
        "\\qquad (\\log\\ \\text{ã¯å‡¹é–¢æ•°})",
        "```",
        "",
        "ãŸã ã—ä»Šã¯ã€`\\(\\mathbb{E}\\)` ã‚’æŒã£ã¦ã„ãªã„ã€‚ãã“ã§ã€è£œåŠ©åˆ†å¸ƒ `\\(q(z)\\)` ã‚’è‡ªåˆ†ã§å…¥ã‚Œã‚‹ã€‚",
        "",
        "```math",
        "p_\\theta(x)=\\int p_\\theta(x,z)\\,dz",
        "=\\int q(z)\\,\\frac{p_\\theta(x,z)}{q(z)}\\,dz",
        "=\\mathbb{E}_{q(z)}\\Bigl[\\frac{p_\\theta(x,z)}{q(z)}\\Bigr]",
        "```",
        "",
        "ã“ã®æ™‚ç‚¹ã§ Jensen ãŒåˆºã•ã‚‹ã€‚",
        "",
        "```math",
        "\\log p_\\theta(x)",
        "= \\log \\mathbb{E}_{q(z)}\\Bigl[\\frac{p_\\theta(x,z)}{q(z)}\\Bigr]",
        "\\ge \\mathbb{E}_{q(z)}\\Bigl[\\log p_\\theta(x,z) - \\log q(z)\\Bigr]",
        "```",
        "",
        "å³è¾ºãŒ ELBOï¼ˆEvidence Lower Boundï¼‰ã€‚",
        "",
        "### 4.3 ELBO åˆ†è§£: ã‚®ãƒ£ãƒƒãƒ—ã¯ KL",
        "",
        "ã“ã“ã§ã€Œãªãœ EM ãŒåæŸã£ã½ã„å‹•ãã‚’ã™ã‚‹ã‹ã€ãŒè¦‹ãˆã‚‹å½¢ã«ãªã‚‹ã€‚",
        "",
        "```math",
        "\\log p_\\theta(x) = \\mathrm{ELBO}(q,\\theta) + D_{\\mathrm{KL}}\\bigl(q(z)\\|p_\\theta(z\\mid x)\\bigr)",
        "```",
        "",
        "ã“ã®ç­‰å¼ã¯ã€æ¬¡ã®äº‹å®Ÿã‚’åŒæ™‚ã«è¨€ã£ã¦ã„ã‚‹ã€‚",
        "",
        "- `\\(D_{\\mathrm{KL}}\\ge 0\\)` ã ã‹ã‚‰ `\\(\\mathrm{ELBO}\\le \\log p_\\theta(x)\\)`ï¼ˆä¸‹ç•Œï¼‰",
        "- ã‚®ãƒ£ãƒƒãƒ—ã¯ `\\(q(z)=p_\\theta(z\\mid x)\\)` ã®ã¨ãã« 0",
        "",
        "*mermaid: åˆ†è§£ã®è¦‹å–ã‚Šå›³*",
        "",
    ]
    L += mermaid_elbo_decomp()
    L += [
        "",
        "### 4.4 EM ã‚’ã€Œäº¤äº’æœ€é©åŒ–ã€ã¨ã—ã¦å°ã",
        "",
        "ç‹™ã„ã¯ `\\(\\log p_\\theta(x)\\)` ã‚’ä¸Šã’ã‚‹ã“ã¨ã€‚ã ãŒç›´æ¥ã¯ç„¡ç†ãªã®ã§ã€ä¸‹ç•Œ `\\(\\mathrm{ELBO}(q,\\theta)\\)` ã‚’ä¸Šã’ã‚‹ã€‚",
        "",
        "EM ã¯æ¬¡ã®2ã¤ã‚’äº¤äº’ã«è¡Œã†ã€‚",
        "",
        "```math",
        "\\textbf{E-step:}\\quad q^{(t+1)}(z) := \\arg\\max_q \\mathrm{ELBO}(q,\\theta^{(t)})",
        "```",
        "",
        "```math",
        "\\textbf{M-step:}\\quad \\theta^{(t+1)} := \\arg\\max_\\theta \\mathrm{ELBO}(q^{(t+1)},\\theta)",
        "```",
        "",
        "E-step ã¯ `\\(q(z)=p_{\\theta^{(t)}}(z\\mid x)\\)` ãŒæœ€é©ã€‚",
        "",
        "ç†ç”±: `\\(\\mathrm{ELBO}=\\log p_\\theta(x)-D_{\\mathrm{KL}}(q\\|p_\\theta)\\)` ã ã‹ã‚‰ã€`\\(q\\)` ã‚’å‹•ã‹ã™ã¨ KL ã‚’æœ€å°åŒ–ã™ã‚‹å•é¡Œã«è½ã¡ã‚‹ã€‚",
        "",
        "### 4.5 å˜èª¿å¢—åŠ ã®éª¨æ ¼ï¼ˆãªãœ loglik ãŒè½ã¡ãªã„ã‹ï¼‰",
        "",
        "EM ã®è‚ã¯ã€Œ`\\(\\log p_\\theta(x)\\)` ãŒåå¾©ã§ä¸‹ãŒã‚‰ãªã„ã€ã¨ã„ã†å˜èª¿æ€§ã€‚",
        "",
        "ã“ã“ã¯å¼å¤‰å½¢ã®é †åºãŒã™ã¹ã¦ã€‚",
        "",
        "1. E-step ã§ `\\(q\\)` ã‚’æœ€é©åŒ–ã—ã¦ ELBO ã‚’ä¸Šã’ã‚‹ï¼ˆã‚‚ã—ãã¯ã‚®ãƒ£ãƒƒãƒ—ã‚’æ¶ˆã™ï¼‰",
        "2. M-step ã§ `\\(\\theta\\)` ã‚’æœ€é©åŒ–ã—ã¦ ELBO ã‚’ä¸Šã’ã‚‹",
        "3. `\\(\\log p_\\theta(x)\\)` ã¯ ELBO ä»¥ä¸Šãªã®ã§ã€çµæœã¨ã—ã¦ `\\(\\log p\\)` ã‚‚ä¸ŠãŒã‚‹",
        "",
        "*mermaid: EMåå¾©*",
        "",
    ]
    L += mermaid_em_flow()
    L += [
        "",
        "### 4.6 å…·ä½“ä¾‹: GMMï¼ˆGaussian Mixture Modelï¼‰",
        "",
        "#### 4.6.1 ãƒ¢ãƒ‡ãƒ«",
        "",
        "è¦³æ¸¬ `\\(x\\in\\mathbb{R}^d\\)`ã€æˆåˆ† `\\(k\\in\\{1,\\dots,K\\}\\)`ã€‚",
        "",
        "```math",
        "p_\\theta(x) = \\sum_{k=1}^K \\pi_k\\,\\mathcal{N}(x\\mid\\mu_k,\\Sigma_k)",
        "\\quad",
        "\\sum_k \\pi_k=1,\\ \\pi_k\\ge 0",
        "```",
        "",
        "æ½œåœ¨å¤‰æ•° `\\(z\\)` ã‚’ one-hot `\\(z\\in\\{e_1,\\dots,e_K\\}\\)` ã¨ã—ã¦æ›¸ãã¨ã€å®Œå…¨ãƒ‡ãƒ¼ã‚¿å°¤åº¦ãŒç¶ºéº—ã«ãªã‚‹ã€‚",
        "",
        "```math",
        "p_\\theta(x,z)",
        "=\\prod_{k=1}^K \\Bigl(\\pi_k\\,\\mathcal{N}(x\\mid\\mu_k,\\Sigma_k)\\Bigr)^{z_k}",
        "```",
        "",
        "ã“ã®å½¢ã¯ã€Œãƒ­ã‚°ã‚’å–ã‚‹ã¨å’Œã«ãªã‚‹ã€ã®ã§ã€M-step ãŒé–‰ã˜ã‚‹ã€‚",
        "",
        "#### 4.6.2 å®Œå…¨ãƒ‡ãƒ¼ã‚¿å¯¾æ•°å°¤åº¦",
        "",
        "```math",
        "\\log p_\\theta(x,z)",
        "=\\sum_{k=1}^K z_k\\Bigl(\\log \\pi_k + \\log \\mathcal{N}(x\\mid\\mu_k,\\Sigma_k)\\Bigr)",
        "```",
        "",
        "#### 4.6.3 Qé–¢æ•°",
        "",
        "```math",
        "Q(\\theta\\mid\\theta^{(t)})",
        ":=\\mathbb{E}_{z\\sim p(z\\mid x,\\theta^{(t)})}[\\log p_\\theta(x,z)]",
        "```",
        "",
        "GMM ã§ã¯ `\\(\\mathbb{E}[z_k]=\\gamma_k\\)` ãŒè²¬ä»»åº¦ï¼ˆresponsibilityï¼‰ã€‚",
        "",
        "#### 4.6.4 E-step: è²¬ä»»åº¦",
        "",
        "```math",
        "\\gamma_{ik}:=p(z_i=k\\mid x_i,\\theta^{(t)})",
        "=\\frac{\\pi_k\\,\\mathcal{N}(x_i\\mid\\mu_k,\\Sigma_k)}{\\sum_{j=1}^K \\pi_j\\,\\mathcal{N}(x_i\\mid\\mu_j,\\Sigma_j)}",
        "```",
        "",
        "ã“ã“ã§å¿…ãšç¢ºèªã™ã‚‹æ€§è³ªãŒ2ã¤ã‚ã‚‹ã€‚",
        "",
        "- `\\(\\gamma_{ik}\\ge 0\\)`ï¼ˆç¢ºç‡ï¼‰",
        "- `\\(\\sum_k \\gamma_{ik}=1\\)`ï¼ˆæ­£è¦åŒ–ï¼‰",
        "",
        "#### 4.6.5 M-step: æ›´æ–°å¼",
        "",
        "```math",
        "N_k:=\\sum_{i=1}^N \\gamma_{ik}",
        "\\quad",
        "\\pi_k\\leftarrow \\frac{N_k}{N}",
        "\\quad",
        "\\mu_k\\leftarrow \\frac{1}{N_k}\\sum_i \\gamma_{ik}x_i,",
        "\\quad",
        "\\Sigma_k\\leftarrow \\frac{1}{N_k}\\sum_i \\gamma_{ik}(x_i-\\mu_k)(x_i-\\mu_k)^\\top",
        "```",
        "",
        "å¼ãã®ã‚‚ã®ã¯ã€Œé‡ã¿ä»˜ãå¹³å‡ã€ã€Œé‡ã¿ä»˜ãåˆ†æ•£ã€ã€‚é›£ã—ã„ã®ã¯ shape ã‚’è½ã¨ã•ãšå®Ÿè£…ã«è½ã¨ã™ã“ã¨ã€‚",
        "",
        "#### 4.6.6 shape ã‚’å›ºå®šã™ã‚‹ï¼ˆè½ã¨ã™ã¨æ­»ã¬ï¼‰",
        "",
        "- `\\(x_i\\in\\mathbb{R}^d\\)`",
        "- `\\(\\mu_k\\in\\mathbb{R}^d\\)`",
        "- `\\(\\Sigma_k\\in\\mathbb{R}^{d\\times d}\\)`",
        "- `\\(\\gamma\\in\\mathbb{R}^{N\\times K}\\)`ï¼ˆè¡ŒãŒãƒ‡ãƒ¼ã‚¿ã€åˆ—ãŒæˆåˆ†ï¼‰",
        "",
        "ã“ã®è¿½è·¡ãŒå´©ã‚Œã‚‹ã¨ã€(a) è»¢ç½®ã®ã—å¿˜ã‚Œã€(b) ãƒ–ãƒ­ãƒ¼ãƒ‰ã‚­ãƒ£ã‚¹ãƒˆã®èª¤ç”¨ã€(c) å…±åˆ†æ•£ãŒå¯¾ç§°ã§ãªããªã‚‹ã€ãŒé€£é–ã—ã¦ç ´ç¶»ã™ã‚‹ã€‚",
        "",
        "*mermaid: GMMã®ç”Ÿæˆã®è¦‹å–ã‚Šå›³*",
        "",
    ]
    L += mermaid_gmm_components()
    L += [
        "",
        "### 4.7 EMã®æ‹¡å¼µ",
        "",
        "#### 4.7.1 Generalized EMï¼ˆGEMï¼‰",
        "",
        "M-step ã‚’å³å¯†æœ€å¤§åŒ–ã§ããªã„ãªã‚‰ã€å°‘ãªãã¨ã‚‚ `\\(Q\\)` ã‚’å¢—ã‚„ã™æ–¹å‘ã«é€²ã‚ã°ã‚ˆã„ã€‚",
        "",
        "```math",
        "Q(\\theta^{(t+1)}\\mid\\theta^{(t)}) \\ge Q(\\theta^{(t)}\\mid\\theta^{(t)})",
        "```",
        "",
        "#### 4.7.2 ECMï¼ˆæ¡ä»¶ä»˜ãæœ€å¤§åŒ–ï¼‰",
        "",
        "`\\(\\theta=(\\theta_1,\\theta_2,\\dots)\\)` ã‚’ãƒ–ãƒ­ãƒƒã‚¯ã«åˆ†ã‘ã¦é †ç•ªã«æœ€å¤§åŒ–ã™ã‚‹ã€‚",
        "",
        "#### 4.7.3 label switchingï¼ˆåŒä¸€æ€§ï¼‰",
        "",
        "GMM ã®æˆåˆ†ãƒ©ãƒ™ãƒ«ã¯å…¥ã‚Œæ›¿ãˆã¦ã‚‚åŒã˜åˆ†å¸ƒã‚’è¡¨ã™ã€‚",
        "",
        "```math",
        "(\\pi_1,\\mu_1,\\Sigma_1),\\dots,(\\pi_K,\\mu_K,\\Sigma_K)",
        "\\quad\\text{ã¯}\\quad",
        "k\\text{ã‚’ç½®æ›ã—ã¦ã‚‚åŒã˜ }p_\\theta(x)",
        "```",
        "",
        "ã ã‹ã‚‰ã€Œå­¦ç¿’ãŒã†ã¾ãã„ã£ãŸã€ã®åˆ¤å®šã¯ã€ãƒ©ãƒ™ãƒ«ä¸€è‡´ã§ã¯ãªãå°¤åº¦ã‚„ã‚¯ãƒ©ã‚¹ã‚¿ã®å½¢ã§è¦‹ã‚‹å¿…è¦ãŒã‚ã‚‹ã€‚",
        "",
        "#### 4.7.4 singularityï¼ˆå°¤åº¦ã®ç™ºæ•£ï¼‰",
        "",
        "GMM ã® MLE ã¯ã€ã‚ã‚‹æˆåˆ†ã®å…±åˆ†æ•£ã‚’ 0 ã«æ½°ã—ã¦ä¸€ç‚¹ã«éé©åˆã™ã‚‹ã¨å°¤åº¦ãŒç™ºæ•£ã™ã‚‹ï¼ˆç„¡é™å¤§ã¸é£›ã¶ï¼‰ã€‚",
        "",
        "ã“ã®ç¾è±¡ã¯ã€å®Ÿè£…ã§ã¯ã“ã†è¦‹ãˆã‚‹ã€‚",
        "",
        "- `\\(\\Sigma_k\\)` ãŒç‰¹ç•°ï¼ˆè¡Œåˆ—å¼ãŒ 0 ã«è¿‘ã„ï¼‰ã«ãªã‚Šã€Cholesky åˆ†è§£ãŒå¤±æ•—ã™ã‚‹",
        "- `\\(\\gamma\\)` ãŒã»ã¼ one-hot ã«ãªã‚Šã€`\\(N_k\\)` ãŒæ¥µç«¯ã«å°ã•ã„æˆåˆ†ãŒå‡ºã‚‹",
        "",
        "å¯¾ç­–ã¯ Part2 ã§å®Ÿå‹™çš„ã«ã¾ã¨ã‚ã‚‹ã€‚",
        "",
        "### 4.8 æ¬ æãƒ‡ãƒ¼ã‚¿ã¨æ½œåœ¨å¤‰æ•°",
        "",
        "æ½œåœ¨å¤‰æ•°ãŒã€Œæœªè¦³æ¸¬ã€ãªã‚‰ã€æ¬ æã®ãƒ¡ã‚«ãƒ‹ã‚ºãƒ ã‚’åŒºåˆ¥ã™ã‚‹å¿…è¦ãŒã‚ã‚‹ã€‚",
        "",
        "- MCAR: Missing Completely At Random",
        "- MAR: Missing At Random",
        "- MNAR: Missing Not At Random",
        "",
        "ã“ã“ã¯è©³ç´°ã«è¸ã¿è¾¼ã¿ã™ããªã„ã€‚ãŸã ã— EM ã®é©ç”¨å¯å¦ã¯ã“ã®åŒºåˆ¥ã§æ±ºã¾ã‚‹ã€‚",
        "",
        "---",
        "",
        "## ä»˜éŒ²A: Jensenâ†’ELBO ã‚’ã€è¡Œå˜ä½ã€ã§è¿½ã†ï¼ˆå°å‡ºå°å¸³ï¼‰",
        "",
        "ã“ã®ä»˜éŒ²ã¯ã€æš—è¨˜ã§ã¯ãªãã€Œé †ç•ªã€ã‚’å›ºå®šã™ã‚‹ãŸã‚ã®ãƒãƒ¼ãƒˆã€‚",
        "",
        "```math",
        "\\log p_\\theta(x)",
        "= \\log \\int p_\\theta(x,z)\\,dz",
        "= \\log \\int q(z)\\,\\frac{p_\\theta(x,z)}{q(z)}\\,dz",
        "= \\log \\mathbb{E}_{q(z)}\\Bigl[\\frac{p_\\theta(x,z)}{q(z)}\\Bigr]",
        "\\ge \\mathbb{E}_{q(z)}[\\log p_\\theta(x,z)-\\log q(z)]",
        "```",
        "",
        "è½ã¨ã—ç©´ï¼ˆæ•°å­¦ã¨ã—ã¦ç ´ç¶»ã™ã‚‹ã‚‚ã®ï¼‰:",
        "",
        "- `q(z)` ã¯ç¢ºç‡åˆ†å¸ƒï¼ˆéè² ãƒ»ç©åˆ†1ï¼‰ã§ãªã‘ã‚Œã°ãªã‚‰ãªã„",
        "- `q(z)=0` ã§ `p(x,z)>0` ãŒã‚ã‚‹ã¨ `p/q` ãŒå£Šã‚Œã‚‹ï¼ˆsupport æ¡ä»¶ï¼‰",
        "",
        "```math",
        "q(z)=0 \\Rightarrow p_\\theta(x,z)=0",
        "```",
        "",
        "ELBO åˆ†è§£ã®æ ¸ã«ãªã‚‹æ’ç­‰å¼:",
        "",
        "```math",
        "D_{\\mathrm{KL}}\\bigl(q(z)\\|p_\\theta(z\\mid x)\\bigr)",
        "=\\mathbb{E}_q[\\log q(z)]-\\mathbb{E}_q[\\log p_\\theta(x,z)]+\\log p_\\theta(x)",
        "```",
        "",
        "ã“ã®å¼ã‚’ `\\(\\log p_\\theta(x)\\)` ã«ã¤ã„ã¦è§£ã‘ã°åˆ†è§£ãŒå‡ºã‚‹ã€‚",
        "",
        "---",
        "",
        "## ä»˜éŒ²B: å¤šå¤‰é‡ã‚¬ã‚¦ã‚¹ã® log å¯†åº¦ã‚’åˆ†è§£ã—ã¦æŒã¤",
        "",
        "GMM ã®å®Ÿè£…ã§å£Šã‚Œã‚‹ã®ã¯ã€ã»ã¼ã“ã“ï¼ˆ`logdet` ã¨ äºŒæ¬¡å½¢å¼ï¼‰ã€‚",
        "",
        "```math",
        "\\log \\mathcal{N}(x\\mid\\mu,\\Sigma)",
        "=-\\frac{1}{2}\\Bigl(d\\log(2\\pi)+\\log\\det\\Sigma+(x-\\mu)^\\top\\Sigma^{-1}(x-\\mu)\\Bigr)",
        "```",
        "",
        "Cholesky ã§æ›¸ãç›´ã™ï¼ˆ`\\Sigma^{-1}` ã‚’ç›´æ¥ä½œã‚‰ãªã„ï¼‰:",
        "",
        "```math",
        "\\Sigma = LL^\\top,\\quad",
        "(x-\\mu)^\\top\\Sigma^{-1}(x-\\mu)=\\|L^{-1}(x-\\mu)\\|_2^2,\\quad",
        "\\log\\det\\Sigma = 2\\sum_{j=1}^d \\log L_{jj}",
        "```",
        "",
        "---",
        "",
        "## ä»˜éŒ²C: M-step ã‚’ãƒ©ã‚°ãƒ©ãƒ³ã‚¸ãƒ¥æœªå®šä¹—æ•°ã§é–‰ã˜ã‚‹ï¼ˆæ··åˆæ¯” Ï€ï¼‰",
        "",
        "æ··åˆæ¯”ã¯åˆ¶ç´„ `\\(\\sum_k\\pi_k=1\\)` ã‚’æŒã¤ã€‚æ›´æ–°å¼ã¯åˆ¶ç´„ä»˜ãæœ€é©åŒ–ã®å¸°çµã€‚",
        "",
        "```math",
        "\\max_{\\pi}\\ \\sum_{i,k}\\gamma_{ik}\\log\\pi_k",
        "\\quad\\text{s.t.}\\quad \\sum_k \\pi_k=1",
        "```",
        "",
        "```math",
        "\\mathcal{J}(\\pi,\\lambda)=\\sum_k N_k\\log\\pi_k + \\lambda\\Bigl(\\sum_k\\pi_k-1\\Bigr)",
        "\\Rightarrow",
        "\\pi_k=\\frac{N_k}{N}",
        "```",
        "",
        "---",
        "",
        "## ä»˜éŒ²D: EM ã¨å¤‰åˆ†æ¨è«–ï¼ˆæ¬¡å›ã¸ã®æ¥ç¶šï¼‰",
        "",
        "E-step ãŒé–‰ã˜ãªã„ï¼ˆ`p(z|x,Î¸)` ãŒè¨ˆç®—ä¸èƒ½ï¼‰ãªã‚‰ã€`q(z)` ã‚’åˆ¶ç´„ä»˜ãã§æœ€é©åŒ–ã™ã‚‹æ–¹å‘ã¸é€²ã‚€ã€‚",
        "",
        "```math",
        "q(z)\\in\\mathcal{Q} \\quad\\Rightarrow\\quad \\max_{q\\in\\mathcal{Q}}\\mathrm{ELBO}(q,\\theta)",
        "```",
        "",
        "ã“ã‚ŒãŒ Variational EMã€‚VAE ã¯ `q` ã‚’æ¨è«–ãƒãƒƒãƒˆã§ç›´æ¥å‡ºã—ã¦ amortize ã™ã‚‹ã€‚",
    ]

    L += [
        "",
        "---",
        "",
        "## å‚è€ƒæ–‡çŒ®",
        "",
        "[^1]: <https://arxiv.org/abs/0710.5696>",
        "[^2]: <https://arxiv.org/abs/cs/0412015>",
        "[^3]: <https://arxiv.org/abs/1105.1476>",
        "[^4]: <https://arxiv.org/abs/0712.4273>",
        "[^5]: <https://arxiv.org/abs/1601.00670>",
        "",
    ]
    L += author_links_and_license()
    return L


def build_part2() -> list[str]:
    L: list[str] = []
    L += frontmatter_part2()

    L += [
        "> **ã“ã®è¬›ç¾©ã«ã¤ã„ã¦**",
        "> Part1 ã®å°å‡ºã‚’ã€ãã®ã¾ã¾æ‰‹ã§å‹•ã‹ã™ã€‚ã“ã“ã‹ã‚‰å…ˆã¯ã€Œå¼ãŒå‹•ãã€ã“ã¨ã ã‘ã‚’ç‹™ã†ã€‚",
        ">",
        "> **å‰ç·¨ã¯ã“ã¡ã‚‰**: [ç¬¬8å› Part1ï¼ˆç†è«–ç·¨ï¼‰](/articles/ml-lecture-08-part1)",
        "",
        "## Learning Objectives",
        "",
        "- [ ] è²¬ä»»åº¦ `\\(\\gamma_{ik}\\)` ã‚’ log-sum-exp ã§å®‰å®šã«è¨ˆç®—ã§ãã‚‹",
        "- [ ] å¤šå¤‰é‡ GMM ã® M-step ã‚’ shape ã¤ãã§å®Ÿè£…ã§ãã‚‹",
        "- [ ] BIC/AIC ã‚’ä½¿ã£ãŸãƒ¢ãƒ‡ãƒ«é¸æŠã‚’å¼ã‹ã‚‰å®Ÿè£…ã¸è½ã¨ã›ã‚‹",
        "- [ ] singularity ã¨ label switching ã‚’ã€Œèµ·ãæ–¹ã€ã‹ã‚‰èª¬æ˜ã§ãã‚‹",
        "",
        "---",
        "",
        "## ğŸ› ï¸ Z5. å®Ÿè£…ã‚¾ãƒ¼ãƒ³ï¼ˆ60åˆ†ï¼‰",
        "",
        "### 5.0 å®Ÿè£…ã®è¨­è¨ˆå›³ï¼ˆæœ€åˆã«å£Šã‚Œã‚‹å ´æ‰€ã‚’æ½°ã™ï¼‰",
        "",
        "GMM-EM ã§å£Šã‚Œã‚‹å ´æ‰€ã¯ã ã„ãŸã„4ã¤ã«é›†ç´„ã™ã‚‹ã€‚",
        "",
        "- `\\(\\gamma\\)` ã®æ­£è¦åŒ–ãŒå´©ã‚Œã‚‹ï¼ˆå’ŒãŒ 1 ã«ãªã‚‰ãªã„ï¼‰",
        "- `\\(\\Sigma\\)` ãŒ SPDï¼ˆæ­£å®šå€¤ï¼‰ã§ãªããªã‚‹ï¼ˆCholesky ãŒè½ã¡ã‚‹ï¼‰",
        "- å¯¾æ•°å°¤åº¦ã®è¨ˆç®—ãŒ underflow/overflow ã™ã‚‹ï¼ˆ`log(0)`ã€`exp(1000)`ï¼‰",
        "- åˆæœŸåŒ–ãŒæ‚ªãå±€æ‰€è§£ã«è½ã¡ã‚‹ï¼ˆã‚¯ãƒ©ã‚¹ã‚¿ãŒæ½°ã‚Œã‚‹ï¼‰",
        "",
        "ã“ã“ã§ã¯ã€å¼ã¨å¤‰æ•°åã‚’ä¸€è‡´ã•ã›ã‚‹ã€‚",
        "",
        "- è¨˜å· `\\(\\pi,\\mu,\\Sigma,\\gamma\\)` â†’ å¤‰æ•° `pi, mu, Sigma, gamma`",
        "- `\\(N\\)`ï¼ˆãƒ‡ãƒ¼ã‚¿æ•°ï¼‰, `\\(K\\)`ï¼ˆæˆåˆ†æ•°ï¼‰, `\\(d\\)`ï¼ˆæ¬¡å…ƒï¼‰",
        "",
        "*mermaid: ç³»è­œå›³*",
        "",
    ]
    L += mermaid_lineage()
    L += [
        "",
        "### 5.1 æ•°å€¤å®‰å®šæ€§: log-sum-exp ã§è²¬ä»»åº¦ã‚’ä½œã‚‹",
        "",
        "è¨ˆç®—ã—ãŸã„ã®ã¯ `\\(\\gamma_{ik}\\)` ã ãŒã€ç›´æ¥ `\\(\\pi_k\\mathcal{N}(x_i|\\mu_k,\\Sigma_k)\\)` ã‚’ä½œã‚‹ã¨ `0` ã«æ½°ã‚Œã‚‹ã€‚",
        "",
        "ãã“ã§ log ç©ºé–“ã«ä¸Šã’ã¦ã€æ­£è¦åŒ–ã ã‘ã¯ `log-sum-exp` ã§ã‚„ã‚‹ã€‚",
        "",
        "shapeï¼ˆè²¬ä»»åº¦è¨ˆç®—ã®ä¸­ã§æœ€ä½é™è¦‹ã‚‹å½¢ï¼‰:",
        "",
        "- `X \\in \\mathbb{R}^{N\\times d}`",
        "- `pi \\in \\mathbb{R}^{K}`",
        "- `mu \\in \\mathbb{R}^{K\\times d}`",
        "- `Sigma \\in \\mathbb{R}^{K\\times d\\times d}`",
        "- `gamma \\in \\mathbb{R}^{N\\times K}`",
        "",
        "è¨˜å·â†”å¤‰æ•°å:",
        "",
        "- `\\(\\pi_k\\)` â†” `pi[k]`",
        "- `\\(\\mu_k\\)` â†” `mu[k]`",
        "- `\\(\\Sigma_k\\)` â†” `Sigma[k]`",
        "- `\\(\\gamma_{ik}\\)` â†” `gamma[i, k]`",
        "",
        "è½ã¨ã—ç©´ï¼ˆæœ€ä½é™ï¼‰:",
        "",
        "- `logsumexp` ã¯ `max` ã‚’å¼•ã„ã¦ã‹ã‚‰ `exp` ã™ã‚‹",
        "- `\\(\\Sigma_k\\)` ã¯ `eps I` ã‚’è¶³ã—ã¦ SPD ã«å¯„ã›ã‚‹",
        "",
        "æ¤œç®—ï¼ˆå¿…é ˆï¼‰:",
        "",
        "- `gamma.sum(axis=1)` ã® min/max ãŒ 1 ã«å¼µã‚Šä»˜ãã“ã¨",
        "",
        "```math",
        "\\log\\sum_{k=1}^K e^{a_k} = m + \\log\\sum_{k=1}^K e^{a_k-m},\\quad m=\\max_k a_k",
        "```",
        "",
        "```python",
        "import numpy as np",
        "",
        "",
        "def logsumexp(a, axis=-1):",
        "    m = np.max(a, axis=axis, keepdims=True)",
        "    s = np.sum(np.exp(a - m), axis=axis, keepdims=True)",
        "    return (m + np.log(s)).squeeze(axis)",
        "",
        "",
        "# sanity: overflow-safe",
        "z = np.array([1000.0, 999.0, 998.0])",
        "print(\"naive exp finite? ->\", np.isfinite(np.sum(np.exp(z))))",
        "print(\"logsumexp        ->\", float(logsumexp(z)))",
        "```",
        "",
        "### 5.2 M-step: æ›´æ–°å¼ã‚’ãã®ã¾ã¾å®Ÿè£…ã™ã‚‹",
        "",
        "E-step ãŒã§ããŸã‚‰ã€æ®‹ã‚Šã¯é‡ã¿ä»˜ãçµ±è¨ˆé‡ã€‚",
        "",
        "```math",
        "N_k = \\sum_{i=1}^N \\gamma_{ik},\\quad",
        "\\pi_k = \\frac{N_k}{N},\\quad",
        "\\mu_k = \\frac{1}{N_k}\\sum_{i=1}^N \\gamma_{ik}x_i,\\quad",
        "\\Sigma_k = \\frac{1}{N_k}\\sum_{i=1}^N \\gamma_{ik}(x_i-\\mu_k)(x_i-\\mu_k)^\\top",
        "```",
        "",
        "shape ã®è½ã¨ã—ç©´ã¯ `\\(\\Sigma_k\\)` ã ã‘ã€‚",
        "",
        "- `(x_i-\\mu_k)(x_i-\\mu_k)^T` ã¯ `dÃ—d`",
        "- `\\gamma_{ik}` ã¯ã‚¹ã‚«ãƒ©ãƒ¼é‡ã¿",
        "- ç·å’Œã¯ `i` ã«å¯¾ã—ã¦å›ã™",
        "",
        "æ•°å€¤å®‰å®šåŒ–ã®æœ€å°æ‰‹å½“:",
        "",
        "- `Sigma[k] = (Sigma[k] + Sigma[k].T) / 2`ï¼ˆå¯¾ç§°åŒ–ï¼‰",
        "- `Sigma[k] += eps I`ï¼ˆSPDã¸ã®å¯„ã›ï¼‰",
        "",
        "æ¤œç®—ï¼ˆæœ€ä½1ã¤ï¼‰:",
        "",
        "- `np.all(np.linalg.eigvalsh(Sigma[k]) > 0)` ã‚’ï¼ˆå°ã•ãª eps ã¤ãã§ï¼‰ç¢ºèªã™ã‚‹",
        "",
        "```math",
        "\\log \\gamma_{ik}",
        "= \\log \\pi_k + \\log \\mathcal{N}(x_i\\mid\\mu_k,\\Sigma_k)",
        "- \\log\\sum_{j=1}^K \\exp\\Bigl(\\log \\pi_j + \\log \\mathcal{N}(x_i\\mid\\mu_j,\\Sigma_j)\\Bigr)",
        "",
        "N_k = \\sum_{i=1}^N \\gamma_{ik},\\quad",
        "\\pi_k = \\frac{N_k}{N},\\quad",
        "\\mu_k = \\frac{1}{N_k}\\sum_{i=1}^N \\gamma_{ik}x_i,\\quad",
        "\\Sigma_k = \\frac{1}{N_k}\\sum_{i=1}^N \\gamma_{ik}(x_i-\\mu_k)(x_i-\\mu_k)^\\top",
        "",
        "\\mathrm{AIC}=2\\,k_{\\mathrm{params}}-2\\,\\log p(X\\mid\\hat\\theta),",
        "\\qquad",
        "\\mathrm{BIC}=\\log(N)\\,k_{\\mathrm{params}}-2\\,\\log p(X\\mid\\hat\\theta)",
        "```",
        "",
        "```python",
        "import numpy as np",
        "",
        "",
        "def logsumexp(a, axis=-1):",
        "    m = np.max(a, axis=axis, keepdims=True)",
        "    s = np.sum(np.exp(a - m), axis=axis, keepdims=True)",
        "    return (m + np.log(s)).squeeze(axis)",
        "",
        "",
        "def log_mvnormal(X, mu_k, Sigma_k, eps=1e-6):",
        "    # X: (N,d), mu_k: (d,), Sigma_k: (d,d)",
        "    N, d = X.shape",
        "    Sigma_k = Sigma_k + eps * np.eye(d)",
        "    L = np.linalg.cholesky(Sigma_k)",
        "    Y = np.linalg.solve(L, (X - mu_k).T)  # (d,N)",
        "    quad = np.sum(Y * Y, axis=0)          # (N,)",
        "    logdet = 2.0 * np.sum(np.log(np.diag(L)))",
        "    return -0.5 * (d * np.log(2.0 * np.pi) + logdet + quad)",
        "",
        "",
        "def e_step(X, pi, mu, Sigma):",
        "    N = X.shape[0]",
        "    K = pi.shape[0]",
        "    log_r = np.zeros((N, K))",
        "    for k in range(K):",
        "        log_r[:, k] = np.log(pi[k] + 1e-12) + log_mvnormal(X, mu[k], Sigma[k])",
        "",
        "    log_norm = logsumexp(log_r, axis=1)      # (N,)",
        "    gamma = np.exp(log_r - log_norm[:, None])",
        "",
        "    row_sum = gamma.sum(axis=1)",
        "    print(\"gamma row-sum min/max:\", float(row_sum.min()), float(row_sum.max()))",
        "    return gamma",
        "",
        "",
        "def m_step(X, gamma, eps=1e-6):",
        "    # X: (N,d), gamma: (N,K)",
        "    N, d = X.shape",
        "    K = gamma.shape[1]",
        "",
        "    Nk = gamma.sum(axis=0) + 1e-12          # (K,)",
        "    pi = Nk / float(N)                      # (K,)",
        "    mu = (gamma.T @ X) / Nk[:, None]        # (K,d)",
        "",
        "    Sigma = np.zeros((K, d, d))",
        "    for k in range(K):",
        "        Xc = X - mu[k][None, :]             # (N,d)",
        "        Sigma[k] = (gamma[:, k][:, None] * Xc).T @ Xc / Nk[k]",
        "        Sigma[k] = 0.5 * (Sigma[k] + Sigma[k].T)",
        "        Sigma[k] = Sigma[k] + eps * np.eye(d)",
        "",
        "    # sanity: SPD-ish",
        "    for k in range(K):",
        "        lam_min = float(np.linalg.eigvalsh(Sigma[k]).min())",
        "        print(f\"Sigma[{k}] min-eig: {lam_min:.3e}\")",
        "",
        "    return pi, mu, Sigma",
        "",
        "",
        "def loglik_gmm(X, pi, mu, Sigma):",
        "    N = X.shape[0]",
        "    K = pi.shape[0]",
        "    log_r = np.zeros((N, K))",
        "    for k in range(K):",
        "        log_r[:, k] = np.log(pi[k] + 1e-12) + log_mvnormal(X, mu[k], Sigma[k])",
        "    return float(np.sum(logsumexp(log_r, axis=1)))",
        "",
        "",
        "def run_em(X, K, steps=30, seed=0):",
        "    rng = np.random.default_rng(seed)",
        "    N, d = X.shape",
        "",
        "    # simple init: random subset for means, shared covariance",
        "    idx = rng.choice(N, size=K, replace=False)",
        "    mu = X[idx].copy()                      # (K,d)",
        "    pi = np.ones(K) / K                     # (K,)",
        "    Sigma0 = np.cov(X.T) + 1e-3 * np.eye(d)  # (d,d)",
        "    Sigma = np.stack([Sigma0.copy() for _ in range(K)], axis=0)",
        "",
        "    ll_hist = []",
        "    for t in range(steps):",
        "        gamma = e_step(X, pi, mu, Sigma)",
        "        pi, mu, Sigma = m_step(X, gamma)",
        "        ll = loglik_gmm(X, pi, mu, Sigma)",
        "        ll_hist.append(ll)",
        "        if t >= 1:",
        "            assert ll_hist[-1] >= ll_hist[-2] - 1e-6  # monotonicity (numerical slack)",
        "",
        "    return pi, mu, Sigma, np.array(ll_hist)",
        "",
        "",
        "def aic_bic(loglik, N, k_params):",
        "    aic = 2.0 * k_params - 2.0 * loglik",
        "    bic = np.log(float(N)) * k_params - 2.0 * loglik",
        "    return aic, bic",
        "",
        "",
        "# demo: synthetic 2D mixture",
        "rng = np.random.default_rng(0)",
        "X = np.vstack([",
        "    rng.normal(loc=(-2.0, 0.0), scale=0.6, size=(200, 2)),",
        "    rng.normal(loc=(+2.0, 0.0), scale=0.6, size=(200, 2)),",
        "])",
        "",
        "for K in [1, 2, 3, 4]:",
        "    pi, mu, Sigma, ll_hist = run_em(X, K, steps=20, seed=K)",
        "    ll = float(ll_hist[-1])",
        "",
        "    # parameter count (full covariance): (K-1) + K*d + K*d*(d+1)/2",
        "    N, d = X.shape",
        "    k_params = (K - 1) + K * d + K * (d * (d + 1) // 2)",
        "    aic, bic = aic_bic(ll, N, k_params)",
        "    print(\"K=\", K, \"loglik=\", ll, \"AIC=\", aic, \"BIC=\", bic)",
        "```",
        "",
        "> **Note:** `assert` ãŒè½ã¡ã‚‹ã¨ãã¯ã€å¼ãŒé–“é•ã„ã¨ã„ã†ã‚ˆã‚Šæ•°å€¤ä¸å®‰å®šï¼ˆepsä¸è¶³ã€SPDå´©å£Šã€åˆæœŸåŒ–ï¼‰ã‚’ç–‘ã†ã€‚",
        "",
        "### 5.3 åˆæœŸåŒ–ï¼ˆK-means++ ã‚’ã©ã†ä½¿ã†ã‹ï¼‰",
        "",
        "å®Ÿè£…ã§ä¸€ç•ªåŠ¹ãã®ã¯åˆæœŸå€¤ã€‚`\\(\\mu_k\\)` ã‚’è‰¯ã„ä½ç½®ã«ç½®ã‘ã‚Œã°ã€EM ã¯ãã®å‘¨ã‚Šã§æ•´ã†ã€‚",
        "",
        "- æœ€ä½é™: `\\(\\mu\\)` ã‚’ãƒ‡ãƒ¼ã‚¿ã‹ã‚‰ãƒ©ãƒ³ãƒ€ãƒ æŠ½å‡ºï¼ˆä¸Šã®å®Ÿè£…ï¼‰",
        "- ã‚‚ã£ã¨è‰¯ã„: `\\(\\mu\\)` ã‚’ K-means++ çš„ã«åˆ†æ•£ã•ã›ã‚‹",
        "- ã•ã‚‰ã«: 1-2å›ã ã‘ K-means ã‚’å›ã—ã¦ã‹ã‚‰ EM ã¸æ¸¡ã™",
        "",
        "ã“ã“ã¯ã‚³ãƒ¼ãƒ‰ã‚’å¢—ã‚„ã™ã‚ˆã‚Šã€ä½•ãŒèµ·ãã‚‹ã‹ã‚’è¨€ãˆã‚‹æ–¹ãŒé‡è¦ã€‚",
        "",
        "### 5.4 singularity ã¨å¯¾ç­–ï¼ˆå®Ÿå‹™ç‰ˆï¼‰",
        "",
        "ç¾å ´ã§èµ·ãã‚‹å…¸å‹ç—‡çŠ¶ã€‚",
        "",
        "- `Sigma[k]` ã®æœ€å°å›ºæœ‰å€¤ãŒè² ã«ãªã‚‹",
        "- `Nk[k]` ãŒ 1 æœªæº€ã¾ã§è½ã¡ã‚‹ï¼ˆã»ã¼ç©ºã‚¯ãƒ©ã‚¹ã‚¿ï¼‰",
        "- `loglik` ãŒçªç„¶è·³ã­ä¸ŠãŒã‚‹ï¼ˆä¸€ç‚¹ã¸ã®éé©åˆï¼‰",
        "",
        "å¯¾ç­–ã¯ã€å¼·ã•é †ã«ã“ã†ã€‚",
        "",
        "1. `Sigma[k] += eps I`ï¼ˆæœ€å°æ‰‹å½“ï¼‰",
        "2. `Nk[k]` ãŒå°ã•ã„æˆåˆ†ã‚’å†åˆæœŸåŒ–ï¼ˆ`mu[k]` ã‚’ãƒ‡ãƒ¼ã‚¿ã‹ã‚‰å¼•ãç›´ã™ï¼‰",
        "3. äº‹å‰åˆ†å¸ƒã‚’å…¥ã‚Œã‚‹ï¼ˆMAP-EM: Wishart/Dirichletï¼‰",
        "",
        "*mermaid: æ•°å€¤å®‰å®šæ€§ã®æµã‚Œ*",
        "",
        "```mermaid",
        "flowchart TD",
        "  A[raw density Ï€_k N(x|Î¼_k,Î£_k)] --> B[underflow to 0]",
        "  B --> C[log space: log Ï€_k + log N]",
        "  C --> D[normalize with log-sum-exp]",
        "  D --> E[exp back to Î³]",
        "  E --> F[assert row-sum == 1]",
        "```",
        "",
        "*mermaid: ãƒ¢ãƒ‡ãƒ«é¸æŠï¼ˆAIC/BICï¼‰*",
        "",
        "```mermaid",
        "flowchart LR",
        "  D[data X] --> F[fit EM for each K]",
        "  F --> L[loglik(K)]",
        "  L --> A[AIC(K)]",
        "  L --> B[BIC(K)]",
        "  A --> S[select K (tradeoff)]",
        "  B --> S",
        "```",
        "",
        "*mermaid: singularity ã®ç™ºç«ãƒ‘ã‚¿ãƒ¼ãƒ³*",
        "",
        "```mermaid",
        "flowchart TD",
        "  A[component collapses] --> B[Î£_k shrinks]",
        "  B --> C[det(Î£_k) -> 0]",
        "  C --> D[log N(x|Î¼,Î£) -> +âˆ at a point]",
        "  D --> E[loglik spikes, Cholesky fails]",
        "  E --> F[fix: epsI / reinit / priors]",
        "```",
        "",
        "*mermaid: ãƒ«ãƒ¼ãƒ—ã¨ãƒ™ã‚¯ãƒˆãƒ«åŒ–ã®å¢ƒç›®*",
        "",
        "```mermaid",
        "flowchart LR",
        "  A[for-loop over i,k] -->|slow| B[vectorize log_r]",
        "  B --> C[still need Cholesky per k]",
        "  C --> D[hotspots: (K times) solve/triangular]",
        "  D --> E[profile -> move heavy parts to faster stack]",
        "```",
        "",
        "---",
        "",
        "## ğŸ”¬ Z6. EM ã®å­å­«ãŸã¡ï¼ˆ20åˆ†ï¼‰",
        "",
        "EM ãŒå‡ºã¦ãã‚‹ã®ã¯ã€Œæ½œåœ¨ãŒã‚ã‚‹ãŒã€äº‹å¾ŒãŒé–‰ã˜ãªã„ã€å•é¡Œå…¨èˆ¬ã€‚",
        "",
        "- HMM: äº‹å¾ŒãŒæ™‚ç³»åˆ—ã®ä¾å­˜ã‚’æŒã¤ï¼ˆBaum-Welchï¼‰[^2]",
        "- PPCA: ç·šå½¢ã‚¬ã‚¦ã‚¹ã®æ½œåœ¨ï¼ˆé–‰ã˜ã‚‹ãŒ EM ã§æ•´ç†ã™ã‚‹ã¨è¦‹é€šã—ãŒè‰¯ã„ï¼‰",
        "- Variational EM: äº‹å¾Œã‚’ `q(z)` ã§è¿‘ä¼¼ã™ã‚‹ï¼ˆVAE ã¸ç›´çµï¼‰[^5]",
        "- EP: è¿‘ä¼¼ã®åˆ¥ç³»çµ±ï¼ˆå±€æ‰€è¿‘ä¼¼ã®ç©ã§å…¨ä½“ã‚’ä½œã‚‹ï¼‰[^6]",
        "",
        "---",
        "",
        "## ğŸ“ Z7. Course I ãƒ•ã‚£ãƒŠãƒ¼ãƒ¬ï¼ˆ10åˆ†ï¼‰",
        "",
        "8å›ã§æ‰‹ã«å…¥ã£ãŸã‚‚ã®ã¯ã€å˜ã«é“å…·ã§ã¯ãªã„ã€‚å¼ã‚’èª­ã‚€ç­‹åŠ›ãŒå¢—ãˆãŸã€‚",
        "",
        "- ç·šå½¢ä»£æ•°: shape ã‚’è½ã¨ã•ãªã„è¦–ç‚¹",
        "- è§£æ: è¿‘ä¼¼ã¨åæŸã®è¨€èª",
        "- ç¢ºç‡ãƒ»æ¸¬åº¦: `\\(\\int\\)` ã®æ­£ä½“",
        "- æƒ…å ±ç†è«–: KL ã¨ä¸‹ç•Œã¨ã„ã†ç¾…é‡ç›¤",
        "- EM: ä¸‹ç•Œã‚’æŠ¼ã—ä¸Šã’ã‚‹åå¾©ï¼ˆæ½œåœ¨ã®æ‰±ã„æ–¹ï¼‰",
        "",
        "æ¬¡ã¯å¤‰åˆ†æ¨è«–ã€‚`q(z)` ã‚’ã€Œæœ€é©ã«é¸ã¶ã€ã‹ã‚‰ã€Œå­¦ç¿’ã§ä½œã‚‹ã€ã¸é€²ã‚€ã€‚",
        "",
    ]

    L += [
        "",
        "## ä»˜éŒ²: å®Ÿè£…ã‚’å£Šã•ãªã„ãŸã‚ã®ãƒ‡ãƒãƒƒã‚°è¦³æ¸¬ç‚¹",
        "",
        "çŸ­ã„å®Ÿè£…ã»ã©ã€å£Šã‚ŒãŸã¨ãã«åŸå› ãŒè¦‹ãˆã«ãã„ã€‚ã ã‹ã‚‰è¦³æ¸¬ç‚¹ã‚’å›ºå®šã™ã‚‹ã€‚",
        "",
        "### è¦³æ¸¬ç‚¹1: `gamma` ã®è¡Œå’Œ",
        "",
        "- æœŸå¾…: `gamma.sum(axis=1)` ãŒ 1 ã«å¼µã‚Šä»˜ã",
        "- å´©ã‚ŒãŸã‚‰: `logsumexp` ã®è»¸ã€`keepdims`ã€`exp(log_r - log_norm[:,None])` ã®å¼•ãç®—æ–¹å‘ã‚’ç–‘ã†",
        "",
        "### è¦³æ¸¬ç‚¹2: `Sigma[k]` ã®SPDæ€§",
        "",
        "- æœŸå¾…: `min_eig(Sigma[k]) > 0`ï¼ˆ`eps` åˆ†ã ã‘æ­£ï¼‰",
        "- å´©ã‚ŒãŸã‚‰: empty component / å¯¾ç§°åŒ–ä¸è¶³ / `eps I` ä¸è¶³",
        "",
        "### è¦³æ¸¬ç‚¹3: loglik ã®å˜èª¿æ€§",
        "",
        "- æœŸå¾…: `ll[t] >= ll[t-1] - 1e-6`",
        "- å´©ã‚ŒãŸã‚‰: `Sigma` ãŒã‚®ãƒªã‚®ãƒª / `gamma` ã®æ­£è¦åŒ–å´©ã‚Œ / empty component",
        "",
        "### è¦³æ¸¬ç‚¹4: `Nk`",
        "",
        "- æœŸå¾…: `Nk` ãŒå°ã•ã„æˆåˆ†ã‚’æ¤œå‡ºã—ã¦å¯¾å‡¦ã™ã‚‹",
        "- å¯¾å‡¦: å†åˆæœŸåŒ–ã€`pi` ã‚¯ãƒªãƒƒãƒ—ã€MAP-EMï¼ˆäº‹å‰åˆ†å¸ƒï¼‰",
        "",
        "---",
        "",
        "## ä»˜éŒ²: ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿æ•° `k_params` ã®æ•°ãˆæ–¹ï¼ˆBIC/AICï¼‰",
        "",
        "full covariance ã®å¤šå¤‰é‡GMMï¼ˆ`d` æ¬¡å…ƒã€`K` æˆåˆ†ï¼‰ã§ã®è‡ªç”±ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿æ•°ã¯æ¬¡ã®åˆè¨ˆã€‚",
        "",
        "- æ··åˆæ¯” `Ï€`: `K` å€‹ã ãŒå’Œ1åˆ¶ç´„ã§ `K-1`",
        "- å¹³å‡ `Î¼`: `K*d`",
        "- å…±åˆ†æ•£ `Î£`: å¯¾ç§°è¡Œåˆ—ãªã®ã§ `d(d+1)/2` ãŒ1æˆåˆ†ã€åˆè¨ˆ `K*d(d+1)/2`",
        "",
        "```math",
        "k_{\\mathrm{params}}=(K-1)+K\\,d + K\\,\\frac{d(d+1)}{2}",
        "```",
        "",
        "ã“ã®æ•°ãˆæ–¹ã‚’é–“é•ãˆã‚‹ã¨ãƒ¢ãƒ‡ãƒ«é¸æŠãŒå£Šã‚Œã‚‹ï¼ˆ`K` ã‚’å¢—ã‚„ã™ã»ã©æœ‰åˆ©ã«ãªã‚‹ç­‰ï¼‰ã€‚",
        "",
        "---",
        "",
        "## å‚è€ƒæ–‡çŒ®",
        "",
        "[^1]: <https://arxiv.org/abs/0710.5696>",
        "[^2]: <https://arxiv.org/abs/cs/0412015>",
        "[^3]: <https://arxiv.org/abs/1105.1476>",
        "[^4]: <https://arxiv.org/abs/0712.4273>",
        "[^5]: <https://arxiv.org/abs/1601.00670>",
        "[^6]: <https://arxiv.org/abs/1301.2294>",
        "",
    ]
    L += author_links_and_license()
    return L


def main() -> None:
    part1 = ARTICLES / "ml-lecture-08-part1.md"
    part2 = ARTICLES / "ml-lecture-08-part2.md"
    write_lines(part1, build_part1())
    write_lines(part2, build_part2())


if __name__ == "__main__":
    main()
